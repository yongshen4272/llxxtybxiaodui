<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>刘霖学校2025年秋季校队情况统计</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 25px;
            position: relative;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        .section-title {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 25px 0 20px;
            font-size: 1.3em;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-count {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: normal;
        }
        .search-box {
            margin: 25px 0;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .search-box input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .search-box input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        .search-box button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .search-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .search-box button.download-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .search-box button.download-btn:hover {
            background: linear-gradient(135deg, #229954, #27ae60);
        }
        .search-box button.download-excel-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .search-box button.download-excel-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        .class-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }
        .class-card {
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
            animation: fadeIn 0.5s ease-out;
        }
        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .class-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .class-count {
            background: #3498db;
            color: white;
            border-radius: 15px;
            padding: 4px 12px;
            font-size: 0.9em;
        }
        .team-list {
            padding: 15px;
        }
        .team-item {
            margin-bottom: 15px;
            border-bottom: 1px dashed #ecf0f1;
            padding-bottom: 15px;
        }
        .team-item:last-child {
            border-bottom: none;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 8px 0;
            transition: all 0.2s;
        }
        .team-header:hover {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding-left: 10px;
        }
        .team-name {
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        .team-count {
            background-color: #3498db;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.8em;
            margin-left: 8px;
        }
        .student-list {
            padding-left: 20px;
            color: #555;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }
        .student-list.expanded {
            max-height: 500px;
        }
        .student-item {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px dotted #f1f1f1;
            animation: slideIn 0.3s ease-out;
        }
        .student-item:last-child {
            border-bottom: none;
        }
        .student-name {
            flex: 1;
        }
        .no-results {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
            font-size: 1.1em;
        }
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            background-color: #f8f9fa;
            transition: all 0.3s;
            font-weight: bold;
        }
        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom-color: white;
            margin-bottom: -1px;
            color: #3498db;
        }
        .tab:hover:not(.active) {
            background-color: #e9ecef;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid #e1e8ed;
        }
        .summary h2 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .summary p {
            font-size: 1.1em;
            color: #34495e;
        }
        .expand-icon {
            margin-left: 5px;
            transition: transform 0.3s ease;
            font-size: 0.9em;
        }
        .team-header.expanded .expand-icon {
            transform: rotate(180deg);
        }
        .error-message {
            background-color: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            color: #2d3436;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            margin-top: 15px;
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: bold;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @media (max-width: 768px) {
            .class-list {
                grid-template-columns: 1fr;
            }
            .search-box {
                flex-direction: column;
            }
            .tabs {
                flex-wrap: wrap;
            }
            .tab {
                flex: 1;
                text-align: center;
                margin-bottom: 5px;
            }
            .section-title {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
    <!-- 引入SheetJS库用于生成Excel文件 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">加载中...</div>
        </div>
    </div>

    <div class="container">
        <h1>刘霖学校2025年秋季各班校队情况统计</h1>
        
        <div class="summary">
            <h2>校队情况总览</h2>
            <p id="totalSummary">全校共计26支校队，总计428名校队学生</p>
        </div>
        
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="输入班级、校队或学生姓名进行搜索...">
            <button id="searchButton">搜索</button>
            <button id="resetButton">重置</button>
            <button id="downloadButton" class="download-btn">下载搜索结果(CSV)</button>
            <button id="downloadExcelButton" class="download-excel-btn">下载全部(Excel)</button>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="primary">小学部</div>
            <div class="tab" data-tab="middle">初中部</div>
        </div>
        
        <div class="tab-content active" id="primary-content">
            <h2 class="section-title">
                小学部校队情况
                <span class="section-count" id="primarySummary">13支校队，235名学生</span>
            </h2>
            <div class="class-list" id="primary-classes">
                <!-- 小学部班级内容将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <div class="tab-content" id="middle-content">
            <h2 class="section-title">
                初中部校队情况
                <span class="section-count" id="middleSummary">13支校队，193名学生</span>
            </h2>
            <div class="class-list" id="middle-classes">
                <!-- 初中部班级内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // 校队数据 - 已核查修正
        const teamData = {
            // 小学部校队
            primary: {
                "小学啦啦操": ["X2304-张馨仪", "X2303-张书宁", "X2302-覃钰茜", "X2302-尹宝乐", "X2302-孟科言", "X2302-孙悠婼", "X2205-吴佳钰", "X2203-伍芯媛", "X2203-滕梓涵", "X2203-向籽涵", "X2202-段雅轩", "X2201-刘璐绮", "X2201-卢红萍", "X2106-谢艾希", "X2106-纪一可", "X2106-张欣蕾", "X2106-李可欣", "X2106-彭梓轩", "X2105-唐珞轩", "X2105-杨乐萱", "X2102-陈瑞汐", "X2102-肖雅宁", "X2101-肖梦蕊", "X2006-向诗涵", "X2006-田若辰", "X2003-陈美", "X2003-周静汐", "X2003-丁予兮"],
                "小学跆拳道": ["X2205-米韦霖", "X2205-贺梓轩", "X2205-李奕辰", "X2103-蒲文彬", "X2007-尹池兰", "X2007-张子浩", "X2007-李晟睿", "X2005-吕奕成", "X2005-蒲俊西", "X2005-张茁彦", "X2005-曾思涵", "X2005-杨佳卫", "X2005-陈雅莉", "X2001-黄锦枫"],
                "小学轮滑": ["X2403-杨亦凡", "X2304-苏睿泽", "X2304-张恩诚", "X2304-张锦辉", "X2304-申书墨", "X2304-杨凯宸", "X2304-张耀午", "X2304-符弈菡", "X2302-全博岩", "X2204-向子曰", "X2204-唐君浩", "X2204-吴皓宸", "X2204-黄芷涵", "X2202-王彬南", "X2202-禹浩轩", "X2202-刘芷涵", "X2202-舒相宁", "X2202-姚梓乐", "X2201-段志睿", "X2106-米鹏锦", "X2104-詹淯文"],
                "小学动漫": ["X2303-黄子涵","X2001-郑家灵","X2001-彭红婷", "X2303-谭一诺", "X2203-舒俊辰", "X2203-周伊林", "X2201-朱虹蓉", "X2106-宋雨洁", "X2106-钟婉钰", "X2105-蒋欣悦", "X2105-陈雅芝", "X2104-石冉卉", "X2003-易诗涵", "X2003-吴可萱", "X2002-龙佩杉"],
                "小学创意素描": ["X2101-肖梦蕊", "X2101-江梓菡", "X2101-李鸿烨", "X2101-舒钰程", "X2101-何向远", "X2104-刘雅洁", "X2104-杨若轩", "X2104-陈紫妍", "X2104-彭家怡", "X2104-周柯含"],
                "小学播音主持": ["X2402-江若溪", "X2302-张思琪", "X2302-李卓依", "X2205-吴佳钰", "X2204-张杰", "X2204-胡心怡", "X2202-伍阳", "X2202-姚紫乐", "X2103-尚芷宇", "X2103-王逸", "X2103-蒋艺珂", "X2101-尹殿杰", "X2003-赵俊杰", "X2001-丁芷辰", "X2001-张俊杰"],
                "小学声乐": ["X2403-刘闰康", "X2402-黄千穗", "X2401-向奕熙", "X2304-曾思颖", "X2304-符奕涵", "X2301-舒馨颐", "X2301-向文琳", "X2202-李玥", "X2004-殷会菡", "X2004-蔡怀钰"],
                "小学围棋": ["X2303-李沐阳", "X2303-李冠霖", "X2302-茹子修", "X2205-张锦荣", "X2204-胡俊豪", "X2202-朱婉馨", "X2201-吴昀", "X2101-李懿诚", "X2101-唐敬杰", "X2101-贺梓轩", "X2006-杨佳颖", "X2003-易梓隽"],
                "小学羽毛球": ["X2402-王远滔", "X2402-曾梦欣", "X2402-余沫荀", "X2401-张梦妍", "X2401-陈浩伟", "X2401-黄胤丞", "X2304-杨晨熙", "X2304-唐于然", "X2304-潘源嵘", "X2304-丁严淳", "X2302-张鑫宇", "X2301-姜博远", "X2301-李宇涛", "X2204-杨卓", "X2202-赵俊恺", "X2202-彭芷晴", "X2107-潘美夕", "X2107-孙悦铭", "X2106-谢东呈", "X2106-吴曾乐", "X2106-彭俊菖", "X2106-李泽阳", "X2105-彭敬焯", "X2105-贺秦菡", "X2105-龙坤琳", "X2104-李俊辰", "X2103-金昱辰", "X2103-张书豪", "X2103-舒雨涵", "X2103-梁严之", "X2103-黄陈", "X2103-梁尚楚", "X2102-杨佳睿", "X2102-邓智芳", "X2101-周子然", "X2101-周子棋", "X2101-魏孜轩", "X2101-潘子航", "X2101-向睿", "X2006-刘宇泽", "X2006-杨子诚", "X2006-游子榆", "X2006-向亮至", "X2006-曹东旭", "X2005-蒲纯希", "X2005-曾思涵", "X2003-赵俊杰", "X2002-段彦兮", "X2002-涂乂丹", "X2002-熊梓萱", "X2001-陆铭远", "X2001-刘宇航"],
                "小学篮球": ["X2403-谢易岑", "X2403-张书浩", "X2403-覃思诚", "X2403-易俊熙", "X2401-刘伽妍", "X2401-孟国强", "X2401-杨智凯", "X2204-易琪然", "X2204-杨诺熙", "X2105-雷彦彬", "X2007-杨依琳", "X2005-黄雪瑶"],
                "小学田径": ["X2205-杨博超", "X2202-贺宇轩", "X2202-蒋馨仪", "X2202-赵思默", "X2202-张诗蕊", "X2202-陈珉恩", "X2201-韩宗航", "X2201-郭梓樊", "X2201-曾一凡", "X2201-蒲照辉", "X2201-汪洋", "X2201-董远桥", "X2201-李俊辰", "X2201-王梓睿", "X2106-杨宗衡", "X2006-侯坤", "X2006-杨棂", "X2006-兰俊龙", "X2004-刘宇翔", "X2004-赵辰宇", "X2004-杨明贵", "X2004-贺奕辰", "X2004-肖俊熙", "X2004-陈浩轩", "X2001-纪然", "X2001-易珑志"],
                "小学软笔书法": ["X2402-杨婷媛", "X2401-戴熙成", "X2204-黎泽诚", "X2204-蒲泓旭", "X2204-向娅洁", "X2201-邓圣镨", "X2201-向圣烨", "X2201-易家鸣", "X2006-郑子杨", "X2006-田纬宸", "X2003-杨子乐"],
                "小学素描": ["X2403-曾煜晨", "X2201-马宇茜", "X2201-曹依依", "X2004-陈紫菡", "X2003-唐紫淋", "X2003-林若歆"]
            },
            // 初中部校队
            middle: {
                "初中舞蹈李": ["C2411-蒲玉茹","C2408-黄龄诺","C2402-杨晓", "C2408-刘苡柔", "C2405-孙湘", "C2405-何馨", "C2404-易好", "C2404-杨雅雯", "C2404-陈嘉沁", "C2404-刘忆梓", "C2404-付塞仪", "C2402-段昭曦"],
                "初中舞蹈周": ["C2502-王梓瑄", "C2503-金彦琳", "C2505-田叶紫", "C2505-汪乐萱", "C2506-杨雅琴", "C2508-徐可佳", "C2508-邓紫萱", "C2509-杨若馨", "C2509-陈铱柃", "C2509-涂芷菡", "C2509-唐果", "C2509-肖倪娜", "C2510-满诗语", "C2510-叶谨萱", "C2409-杨谨伊", "C2302-郑欣怡", "C2306-刘诗茜", "C2307-陈奕媛", "C2307-谢雅琪"],
                "初中跆拳道": ["C2508-杨子涵", "C2507-周伟超", "C2506-米紫涵", "C2506-黄子皓", "C2407-孙彪", "C2403-李书含"],
                "初中声乐": [ "C2305-向俊熙", "C2312-曾译平", "C2402-谢微", "C2402-陈子茜", "C2405-韩逸菲", "C2405-姚思垣", "C2405-陆浩瑜", "C2408-李紫萱", "C2411-刘晨熙", "C2411-周扬诗韵", "C2502-谢菲", "C2502-刘紫娴", "C2503-刘雄俊", "C2507-刘星姿", "C2509-黄雅芸", "C2509-李桢尧", "C2509-赵彬睿", "C2510-黄倩瑶", "C2510-田瑞欣"],
                "初中素描": ["C2510-王兀昕", "C2507-张紫琪", "C2506-陈梓涵", "C2412-陈芷伊", "C2411-蒲明辉", "C2409-李威辰", "C2409-熊一捷", "C2406-吴梓洋", "C2311-张蔓馨", "C2309-龙心怡", "C2308-张惠淇", "C2307-舒雅琪", "C2306-李佳琦", "C2305-张顺源", "C2301-丁子涵", "C2301-李京矜"],
                "初中田径陈": ["C2511-吴静", "C2510-叶诚洺", "C2510-杨雅雯", "C2510-刘亿", "C2510-杨彬", "C2509-李俊杰", "C2509-向钉瑾", "C2506-向思箐", "C2505-谢景发", "C2501-张栖语", "C2411-向俊旭", "C2411-饶心睿", "C2403-袁文熙", "C2403-杨宇航"],
                "初中田径成": ["C2508-向明宇", "C2412-李杰峰", "C2412-余子涵", "C2412-杨佳蓉", "C2412-刘雨丰", "C2409-唐志强", "C2409-刘子荣", "C2409-印梓涵", "C2408-向诗涵", "C2406-夏秋晨", "C2312-刘鸿", "C2312-向景轩", "C2310-陆军", "C2310-占敏扬", "C2310-彭泽戎", "C2310-杨浩宇", "C2308-李嘉飞", "C2308-江关伟", "C2308-张俊杰", "C2307-包美朵"],
                "初中播音主持": ["C2505-夏乙丹", "C2505-唐艺珊", "C2505-黄文佳", "C2503-张懿臻", "C2412-蒲宣丞", "C2409-陈智华"],
                "初中足球": ["C2511-曾彦博", "C2511-廖琛祥", "C2510-邓博烊", "C2510-杨海翔", "C2510-黄星程", "C2510-田翰轩", "C2509-罗昱奇", "C2508-黄鑫", "C2507-欧阳亿欣", "C2507-金嘉昱", "C2506-刘嘉楠", "C2506-周宇皓", "C2504-李彦廷", "C2503-刘文涛", "C2406-唐梓轩", "C2403-邱俊洋", "C2401-熊淇骏", "C2401-曾大成", "C2312-张嵫杭", "C2312-伍奕铭", "C2309-刘峰玮", "C2306-杨惠翔", "C2306-况虹筑", "C2302-陈俊同"],
                "初中羽毛球": ["C2506-谢富丞", "C2506-彭宸霖", "C2506-杨辰熙", "C2506-彭子玥", "C2412-刘智宇", "C2409-韩浩轩", "C2409-赵子墨", "C2409-刘俊轩", "C2409-杨卓霖", "C2409-黄鸿凯", "C2408-姚震霆", "C2408-向涵宇", "C2406-潘俊", "C2405-乔钰淋", "C2402-唐希睿", "C2312-舒轼", "C2311-杨博林", "C2310-刘恺文", "C2310-吴呈祥", "C2310-丁向宇", "C2310-石福杰", "C2305-乔磊", "C2305-杨子骁"],
                "初中篮球": ["C2511-肖增益", "C2510-唐梓浩", "C2510-刘一枫", "C2509-谭聿横", "C2509-夏振义", "C2504-吴羽泽", "C2504-杨梓晨", "C2504-舒智宇", "C2503-屈文轩", "C2503-周珅旭", "C2503-蔡子晨", "C2503-满兴洋", "C2412-谌锐", "C2412-尹骏熙", "C2412-何钰铭", "C2412-邱绍峰", "C2411-米润", "C2411-邹家伟", "C2411-彭伟轩", "C2402-陈墨轩", "C2401-陈鹏", "C2312-陈子涵", "C2310-龙宣呈", "C2309-谌泽驻", "C2308-张宇翔", "C2308-高海铭", "C2308-吕浩宇", "C2307-翟一凡", "C2306-邓联洲", "C2304-谢翼", "C2304-曾俊铧", "C2304-田荆晨"],
                "初中女子篮球": ["C2505-吴晨俊", "C2505-谌雨泽", "C2504-丁佳琪", "C2503-何宇程", "C2503-何宇桐", "C2407-伍薇琦"],
                "初中武术": ["C2403-严梓睿", "C2306-武子尧"],
                "初中长笛": ["C2501-米艾茹"]
            }
        };

        // 专业上课时间数据
        const teamSchedule = {
            "小学啦啦操": "周一、周三 16:00-17:30",
            "小学跆拳道": "周二、周四 16:30-18:00",
            "小学轮滑": "周五 15:30-17:00",
            "小学动漫": "周三 16:00-17:30",
            "小学创意素描": "周四 16:00-17:30",
            "小学播音主持": "周二 16:30-18:00",
            "小学声乐": "周一、周三 16:30-18:00",
            "小学围棋": "周五 16:00-17:30",
            "小学羽毛球": "周一、周三、周五 16:30-18:00",
            "小学篮球": "周二、周四 16:00-17:30",
            "小学田径": "周一、周三、周五 16:00-17:30",
            "小学软笔书法": "周四 16:00-17:30",
            "小学素描": "周二 16:30-18:00",
            "初中舞蹈李": "周一、周三 16:30-18:00",
            "初中舞蹈周": "周二、周四 16:30-18:00",
            "初中跆拳道": "周一、周三 17:00-18:30",
            "初中声乐": "周二、周五 16:30-18:00",
            "初中素描": "周四 16:30-18:00",
            "初中田径陈": "周一、周三、周五 16:30-18:00",
            "初中田径成": "周二、周四 16:30-18:00",
            "初中播音主持": "周三 16:30-18:00",
            "初中足球": "周一、周三、周五 16:30-18:00",
            "初中羽毛球": "周二、周四 16:30-18:00",
            "初中篮球": "周一、周三、周五 16:30-18:00",
            "初中女子篮球": "周二、周四 16:30-18:00",
            "初中武术": "周五 16:30-18:00",
            "初中长笛": "周三 16:30-18:00"
        };

        // 存储当前搜索结果
        let currentFilteredData = {
            primary: {},
            middle: {}
        };

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // 显示加载动画
                showLoading('正在加载校队数据...');
                
                // 延迟执行以展示加载动画
                setTimeout(() => {
                    // 从本地存储加载状态
                    loadStateFromStorage();
                    
                    // 生成班级汇总数据
                    generateClassSummary();
                    updateTotalSummary();
                    
                    // 隐藏加载动画
                    hideLoading();
                    
                    // 标签页切换
                    document.querySelectorAll('.tab').forEach(tab => {
                        tab.addEventListener('click', function() {
                            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                            
                            this.classList.add('active');
                            document.getElementById(this.dataset.tab + '-content').classList.add('active');
                            
                            // 保存当前标签状态
                            saveStateToStorage();
                        });
                    });
                    
                    // 搜索功能
                    document.getElementById('searchButton').addEventListener('click', performSearch);
                    
                    // 搜索框输入时自动重置
                    document.getElementById('searchInput').addEventListener('input', function() {
                        if (this.value.trim() === '') {
                            generateClassSummary();
                        }
                    });
                    
                    // 搜索框回车键搜索
                    document.getElementById('searchInput').addEventListener('keyup', function(event) {
                        if (event.key === 'Enter') {
                            performSearch();
                        }
                    });
                    
                    // 重置功能
                    document.getElementById('resetButton').addEventListener('click', function() {
                        document.getElementById('searchInput').value = '';
                        generateClassSummary();
                        saveStateToStorage();
                    });
                    
                    // 下载功能
                    document.getElementById('downloadButton').addEventListener('click', downloadSearchResults);
                    document.getElementById('downloadExcelButton').addEventListener('click', downloadAllTeamsExcel);
                }, 800); // 延迟800ms展示加载动画
            } catch (error) {
                console.error('初始化页面时出错:', error);
                showError('初始化页面时出错，请检查数据格式是否正确');
                hideLoading();
            }
        });

        // 显示加载动画
        function showLoading(message = '加载中...') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            loadingText.textContent = message;
            loadingOverlay.classList.add('active');
        }

        // 隐藏加载动画
        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.remove('active');
        }

        // 显示错误信息
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.container').prepend(errorDiv);
        }

        // 保存状态到本地存储
        function saveStateToStorage() {
            const state = {
                searchTerm: document.getElementById('searchInput').value,
                activeTab: document.querySelector('.tab.active').dataset.tab,
                timestamp: new Date().getTime()
            };
            
            try {
                localStorage.setItem('schoolTeamState', JSON.stringify(state));
            } catch (error) {
                console.warn('无法保存状态到本地存储:', error);
            }
        }

        // 从本地存储加载状态
        function loadStateFromStorage() {
            try {
                const savedState = localStorage.getItem('schoolTeamState');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    
                    // 恢复搜索词
                    if (state.searchTerm) {
                        document.getElementById('searchInput').value = state.searchTerm;
                    }
                    
                    // 恢复激活的标签页
                    if (state.activeTab) {
                        document.querySelectorAll('.tab').forEach(tab => {
                            tab.classList.remove('active');
                            if (tab.dataset.tab === state.activeTab) {
                                tab.classList.add('active');
                            }
                        });
                        
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                            if (content.id === state.activeTab + '-content') {
                                content.classList.add('active');
                            }
                        });
                    }
                }
            } catch (error) {
                console.warn('无法从本地存储加载状态:', error);
            }
        }

        // 更新总统计
        function updateTotalSummary() {
            try {
                let totalTeams = 0;
                let totalStudents = 0;
                let primaryTeams = 0;
                let primaryStudents = 0;
                let middleTeams = 0;
                let middleStudents = 0;
                
                // 安全检查：确保teamData对象存在且包含primary和middle属性
                if (!teamData || typeof teamData !== 'object') {
                    throw new Error('teamData数据格式错误');
                }
                
                // 计算小学部
                if (teamData.primary && typeof teamData.primary === 'object') {
                    primaryTeams = Object.keys(teamData.primary).length;
                    for (const team in teamData.primary) {
                        // 安全检查：确保teamData.primary[team]是数组
                        if (Array.isArray(teamData.primary[team])) {
                            primaryStudents += teamData.primary[team].length;
                        }
                    }
                    totalTeams += primaryTeams;
                    totalStudents += primaryStudents;
                    
                    // 更新小学部统计
                    document.getElementById('primarySummary').textContent = 
                        `${primaryTeams}支校队，${primaryStudents}名学生`;
                }
                
                // 计算初中部
                if (teamData.middle && typeof teamData.middle === 'object') {
                    middleTeams = Object.keys(teamData.middle).length;
                    for (const team in teamData.middle) {
                        // 安全检查：确保teamData.middle[team]是数组
                        if (Array.isArray(teamData.middle[team])) {
                            middleStudents += teamData.middle[team].length;
                        }
                    }
                    totalTeams += middleTeams;
                    totalStudents += middleStudents;
                    
                    // 更新初中部统计
                    document.getElementById('middleSummary').textContent = 
                        `${middleTeams}支校队，${middleStudents}名学生`;
                }
                
                document.getElementById('totalSummary').textContent = 
                    `全校共计${totalTeams}支校队，总计${totalStudents}名校队学生`;
            } catch (error) {
                console.error('更新统计信息时出错:', error);
                showError('更新统计信息时出错，请检查数据格式');
            }
        }

        // 生成班级汇总数据
        function generateClassSummary() {
            try {
                // 显示加载动画
                showLoading('正在生成班级汇总...');
                
                // 延迟执行以展示加载动画
                setTimeout(() => {
                    // 清空现有内容
                    document.getElementById('primary-classes').innerHTML = '';
                    document.getElementById('middle-classes').innerHTML = '';
                    
                    // 安全检查：确保teamData对象存在且包含primary和middle属性
                    if (!teamData || typeof teamData !== 'object') {
                        throw new Error('teamData数据格式错误');
                    }
                    
                    // 生成小学部班级汇总
                    if (teamData.primary && typeof teamData.primary === 'object') {
                        const primaryClasses = organizeByClass(teamData.primary);
                        renderClassSummary('primary-classes', primaryClasses);
                    } else {
                        document.getElementById('primary-classes').innerHTML = 
                            '<div class="no-results">小学部数据格式错误</div>';
                    }
                    
                    // 生成初中部班级汇总
                    if (teamData.middle && typeof teamData.middle === 'object') {
                        const middleClasses = organizeByClass(teamData.middle);
                        renderClassSummary('middle-classes', middleClasses);
                    } else {
                        document.getElementById('middle-classes').innerHTML = 
                            '<div class="no-results">初中部数据格式错误</div>';
                    }
                    
                    // 保存状态到本地存储
                    saveStateToStorage();
                    
                    // 隐藏加载动画
                    hideLoading();
                }, 500);
            } catch (error) {
                console.error('生成班级汇总数据时出错:', error);
                showError('生成班级汇总数据时出错，请检查数据格式');
                hideLoading();
            }
        }

        // 按班级组织数据
        function organizeByClass(teamsData) {
            const classes = {};
            
            for (const [teamName, students] of Object.entries(teamsData)) {
                // 安全检查：确保students是数组
                if (!Array.isArray(students)) {
                    console.warn(`校队"${teamName}"的学生数据不是数组格式，已跳过`);
                    continue;
                }
                
                students.forEach(student => {
                    // 安全检查：确保学生数据格式正确
                    if (typeof student !== 'string' || !student.includes('-')) {
                        console.warn(`学生数据格式错误: "${student}"，已跳过`);
                        return;
                    }
                    
                    const [classInfo, studentName] = student.split('-');
                    if (!classes[classInfo]) {
                        classes[classInfo] = {};
                    }
                    if (!classes[classInfo][teamName]) {
                        classes[classInfo][teamName] = [];
                    }
                    classes[classInfo][teamName].push(studentName);
                });
            }
            
            return classes;
        }

        // 渲染班级汇总
        function renderClassSummary(containerId, classesData) {
            const container = document.getElementById(containerId);
            
            if (Object.keys(classesData).length === 0) {
                container.innerHTML = '<div class="no-results">暂无数据</div>';
                return;
            }
            
            // 按班级排序
            const sortedClasses = Object.keys(classesData).sort((a, b) => {
                // 提取班级编号进行比较
                const aNum = parseInt(a.replace(/[^\d]/g, ''));
                const bNum = parseInt(b.replace(/[^\d]/g, ''));
                return aNum - bNum;
            });
            
            sortedClasses.forEach(classInfo => {
                const classCard = document.createElement('div');
                classCard.className = 'class-card';
                
                // 计算班级总人数
                let classTotal = 0;
                for (const team in classesData[classInfo]) {
                    classTotal += classesData[classInfo][team].length;
                }
                
                const classHeader = document.createElement('div');
                classHeader.className = 'class-header';
                classHeader.innerHTML = `
                    ${classInfo}
                    <span class="class-count">${classTotal}人</span>
                `;
                
                const teamList = document.createElement('div');
                teamList.className = 'team-list';
                
                for (const [teamName, students] of Object.entries(classesData[classInfo])) {
                    const teamItem = document.createElement('div');
                    teamItem.className = 'team-item';
                    
                    const teamHeader = document.createElement('div');
                    teamHeader.className = 'team-header';
                    
                    const teamNameDiv = document.createElement('div');
                    teamNameDiv.className = 'team-name';
                    teamNameDiv.innerHTML = `${teamName} <span class="team-count">${students.length}</span>`;
                    
                    const expandIcon = document.createElement('span');
                    expandIcon.className = 'expand-icon';
                    expandIcon.innerHTML = '▼';
                    
                    teamHeader.appendChild(teamNameDiv);
                    teamHeader.appendChild(expandIcon);
                    
                    const studentList = document.createElement('div');
                    studentList.className = 'student-list';
                    
                    students.forEach(student => {
                        const studentItem = document.createElement('div');
                        studentItem.className = 'student-item';
                        
                        const studentNameDiv = document.createElement('div');
                        studentNameDiv.className = 'student-name';
                        studentNameDiv.textContent = student;
                        
                        studentItem.appendChild(studentNameDiv);
                        studentList.appendChild(studentItem);
                    });
                    
                    // 点击展开/收起学生名单
                    teamHeader.addEventListener('click', function() {
                        this.classList.toggle('expanded');
                        studentList.classList.toggle('expanded');
                    });
                    
                    teamItem.appendChild(teamHeader);
                    teamItem.appendChild(studentList);
                    teamList.appendChild(teamItem);
                }
                
                classCard.appendChild(classHeader);
                classCard.appendChild(teamList);
                container.appendChild(classCard);
            });
        }

        // 执行搜索
        function performSearch() {
            try {
                const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
                
                // 显示加载动画
                showLoading('正在搜索...');
                
                // 延迟执行以展示加载动画
                setTimeout(() => {
                    if (!searchTerm) {
                        generateClassSummary();
                        return;
                    }
                    
                    // 安全检查：确保teamData对象存在且包含primary和middle属性
                    if (!teamData || typeof teamData !== 'object') {
                        throw new Error('teamData数据格式错误');
                    }
                    
                    // 搜索小学部
                    if (teamData.primary && typeof teamData.primary === 'object') {
                        const filteredPrimary = filterTeams(teamData.primary, searchTerm);
                        currentFilteredData.primary = filteredPrimary;
                        const primaryClasses = organizeByClass(filteredPrimary);
                        document.getElementById('primary-classes').innerHTML = '';
                        renderClassSummary('primary-classes', primaryClasses);
                    }
                    
                    // 搜索初中部
                    if (teamData.middle && typeof teamData.middle === 'object') {
                        const filteredMiddle = filterTeams(teamData.middle, searchTerm);
                        currentFilteredData.middle = filteredMiddle;
                        const middleClasses = organizeByClass(filteredMiddle);
                        document.getElementById('middle-classes').innerHTML = '';
                        renderClassSummary('middle-classes', middleClasses);
                    }
                    
                    // 保存状态到本地存储
                    saveStateToStorage();
                    
                    // 隐藏加载动画
                    hideLoading();
                }, 500);
            } catch (error) {
                console.error('执行搜索时出错:', error);
                showError('执行搜索时出错，请检查数据格式');
                hideLoading();
            }
        }

        // 过滤校队数据
        function filterTeams(teamsData, searchTerm) {
            const filtered = {};
            
            for (const [teamName, students] of Object.entries(teamsData)) {
                // 安全检查：确保students是数组
                if (!Array.isArray(students)) {
                    continue;
                }
                
                // 检查校队名称是否匹配
                if (teamName.toLowerCase().includes(searchTerm)) {
                    filtered[teamName] = students;
                    continue;
                }
                
                // 检查学生是否匹配
                const matchingStudents = students.filter(student => {
                    // 安全检查：确保学生数据格式正确
                    if (typeof student !== 'string' || !student.includes('-')) {
                        return false;
                    }
                    
                    const [classInfo, studentName] = student.split('-');
                    return classInfo.toLowerCase().includes(searchTerm) || 
                           studentName.toLowerCase().includes(searchTerm);
                });
                
                if (matchingStudents.length > 0) {
                    filtered[teamName] = matchingStudents;
                }
            }
            
            return filtered;
        }

        // 下载搜索结果(CSV格式)
        function downloadSearchResults() {
            try {
                showLoading('正在生成下载文件...');
                
                // 延迟执行以展示加载动画
                setTimeout(() => {
                    // 准备CSV数据
                    let csvContent = "学部,班级,姓名,专业,上课时间\n";
                    
                    // 处理搜索结果
                    const searchTerm = document.getElementById('searchInput').value.trim();
                    let dataToDownload = {};
                    
                    if (searchTerm) {
                        // 使用搜索结果
                        dataToDownload = currentFilteredData;
                    } else {
                        // 使用全部数据
                        dataToDownload = teamData;
                    }
                    
                    // 处理小学部数据
                    if (dataToDownload.primary && typeof dataToDownload.primary === 'object') {
                        for (const [teamName, students] of Object.entries(dataToDownload.primary)) {
                            students.forEach(student => {
                                const [classInfo, studentName] = student.split('-');
                                const schedule = teamSchedule[teamName] || "未安排";
                                csvContent += `小学部,${classInfo},${studentName},${teamName},${schedule}\n`;
                            });
                        }
                    }
                    
                    // 处理初中部数据
                    if (dataToDownload.middle && typeof dataToDownload.middle === 'object') {
                        for (const [teamName, students] of Object.entries(dataToDownload.middle)) {
                            students.forEach(student => {
                                const [classInfo, studentName] = student.split('-');
                                const schedule = teamSchedule[teamName] || "未安排";
                                csvContent += `初中部,${classInfo},${studentName},${teamName},${schedule}\n`;
                            });
                        }
                    }
                    
                    // 创建Blob对象
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    
                    // 创建下载链接
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `刘霖学校2025年秋季校队名单_${searchTerm || '全部'}.csv`);
                    link.style.visibility = 'hidden';
                    
                    // 添加到页面并触发下载
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    hideLoading();
                }, 500);
            } catch (error) {
                console.error('下载校队名单时出错:', error);
                showError('下载校队名单时出错，请重试');
                hideLoading();
            }
        }

        // 下载全部校队数据(Excel格式，按专业分工作表)
        function downloadAllTeamsExcel() {
            try {
                showLoading('正在生成Excel文件...');
                
                // 延迟执行以展示加载动画
                setTimeout(() => {
                    // 创建工作簿
                    const wb = XLSX.utils.book_new();
                    
                    // 处理小学部数据
                    if (teamData.primary && typeof teamData.primary === 'object') {
                        for (const [teamName, students] of Object.entries(teamData.primary)) {
                            // 创建工作表数据
                            const wsData = [
                                ['学部', '班级', '姓名', '专业', '上课时间']
                            ];
                            
                            // 添加学生数据
                            students.forEach(student => {
                                const [classInfo, studentName] = student.split('-');
                                const schedule = teamSchedule[teamName] || "未安排";
                                wsData.push(['小学部', classInfo, studentName, teamName, schedule]);
                            });
                            
                            // 创建工作表
                            const ws = XLSX.utils.aoa_to_sheet(wsData);
                            
                            // 将工作表添加到工作簿
                            XLSX.utils.book_append_sheet(wb, ws, teamName);
                        }
                    }
                    
                    // 处理初中部数据
                    if (teamData.middle && typeof teamData.middle === 'object') {
                        for (const [teamName, students] of Object.entries(teamData.middle)) {
                            // 创建工作表数据
                            const wsData = [
                                ['学部', '班级', '姓名', '专业', '上课时间']
                            ];
                            
                            // 添加学生数据
                            students.forEach(student => {
                                const [classInfo, studentName] = student.split('-');
                                const schedule = teamSchedule[teamName] || "未安排";
                                wsData.push(['初中部', classInfo, studentName, teamName, schedule]);
                            });
                            
                            // 创建工作表
                            const ws = XLSX.utils.aoa_to_sheet(wsData);
                            
                            // 将工作表添加到工作簿
                            XLSX.utils.book_append_sheet(wb, ws, teamName);
                        }
                    }
                    
                    // 生成Excel文件并下载
                    XLSX.writeFile(wb, '刘霖学校2025年秋季校队名单_全部.xlsx');
                    
                    hideLoading();
                }, 500);
            } catch (error) {
                console.error('生成Excel文件时出错:', error);
                showError('生成Excel文件时出错，请重试');
                hideLoading();
            }
        }
    </script>
</body>
</html>


